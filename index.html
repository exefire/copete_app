<!DOCTYPE html>
<html>
<head>
<title>Aloo Copete App</title>
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script type="text/javascript" charset="utf-8" src="jquery-1.8.2.min.js"></script>
<script type="text/javascript" charset="utf-8" src="jquery.mobile-1.2.0.min.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script type="text/javascript" charset="utf-8">
var url_master = 'http://www.aloocopete.cl/comandas/';	
var watchID = null;
// Wait for Cordova to load
//
document.addEventListener("deviceready", onDeviceReady, false);

// Cordova is ready
//
function onDeviceReady() {
		navigator.alert('Cordova is ready');
}

function getCurrentPosition() {
		navigator.geolocation.getCurrentPosition(onSuccess, onError);    
}
		
function watchPosition() {
		// Update every 3 seconds
		var options = { frequency: 3000 };
		watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);        
}
// onSuccess Geolocation
//
function onSuccess(position) {
		var element = document.getElementById('geolocation');
		element.innerHTML = "";
		/* element.innerHTML = 'Latitude: '           + position.coords.latitude              + '<br />' +
												'Longitude: '          + position.coords.longitude             + '<br />' +
												'Altitude: '           + position.coords.altitude              + '<br />' +
												'Accuracy: '           + position.coords.accuracy              + '<br />' +
												'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
												'Heading: '            + position.coords.heading               + '<br />' +
												'Speed: '              + position.coords.speed                 + '<br />' +
												'Timestamp: '          + new Date(position.timestamp)          + '<br />'; */
		initialize(position.coords.latitude,position.coords.longitude);
		document.getElementById('lat').value = position.coords.latitude;
		document.getElementById('lon').value = position.coords.longitude;
		document.getElementById('boton_inicar').style.display = 'block';
		document.getElementById('geolocation').style.display = 'none';
}

// onError Callback receives a PositionError object
//
function onError(error) {
		alert('code: '    + error.code    + '\n' +
					'message: ' + error.message + '\n');
}

function initialize(lat,lon) {
  var myLatlng = new google.maps.LatLng(lat,lon);
  var mapOptions = {
    zoom: 15,
    center: myLatlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  var marker = new google.maps.Marker({
      position: myLatlng,
      map: map,
      title: 'Hello World!'
  });
}
// alert dialog dismissed
function alertDismissed() {
		// do something
}
function mostrar(){
	var lat = document.getElementById('lat').value;
	var lon = document.getElementById('lon').value;
	var location = ( '(' + lat + ',' + lon + ')');
	url = url_master + "poly_punto.php?buscar_sector="+location+'&app';
	
	$.ajax({
		url: url,
		dataType: "jsonp",
		async: true,
		success: function (result) {
			var nombre = result['nombre'];
			var msg = 'Sector: ' + nombre;
			navigator.notification.alert(
					msg,  // message
					alertDismissed,         // callback
					'Aloo Copete',            // title
					'Listo!'                  // buttonName
			);
		},
		error: function (request,error) {
			var msg = 'Error conectando con el servidor!';
			navigator.notification.alert(
					msg,  // message
					alertDismissed,         // callback
					'Aloo Copete',            // title
					'OK'                  // buttonName
			);
		}
	});         
	
	
}
</script>
<meta charset="UTF-8">
<style type="text/css">
html, body {
	height: 100%;
	margin: 0;
	padding: 0;
}
#map-canvas, #map_canvas {
	width: 100%;
	height: 200px;
}
[data-role=page] {
	height: 100% !important;
	position:relative !important;
}
[data-role=footer] {
	bottom:0;
	position:absolute !important;
	top: auto !important;
	width:100%;
}
</style>
<link href="jquery.mobile-1.2.0.min.css" rel="stylesheet" type="text/css">
</head>
<body onLoad="getCurrentPosition()">
<!-- Start of first page -->
<div data-role="page" id="inicio">
  <div data-role="header">
    <h1>Aloo Copete</h1>
  </div>
  <!-- /header -->
  
  <div data-role="content">
    <div id="geolocation" style="padding:10px; text-align:center;">Cargando ubicaci√≥n...</div>
    <div id="map-canvas"></div>
    <input type="hidden" name="lat" id="lat">
    <input type="hidden" name="lon" id="lon">
    <div id="boton_inicar" style="display:none; padding:10px; text-align:center;">
    <input type="button" onClick="mostrar()" value="Iniciar Pedido">
    </div>

  </div>
  <!-- /content -->
  
  <div data-role="footer">
    <!--<h4>Delivery - Carrete Seguro</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#inicio" class="ui-btn-active">Pedido</a></li>
			<li><a href="#bar">Two</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
  </div>
  <!-- /footer --> 
</div>
<!-- /page -->





<!-- Start of second page -->
<div data-role="page" id="bar">

	<div data-role="header">
    <h1>Aloo Copete</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>I'm the second in the source order so I'm hidden when the page loads. I'm just shown if a link that references my id is beeing clicked.</p>		
		<p><a href="#foo">Back to foo</a></p>	    
	</div><!-- /content -->

	<div data-role="footer">
		<!--<h4>Page Footer</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#inicio">One</a></li>
			<li><a href="#bar" class="ui-btn-active">Two</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
	</div><!-- /footer -->
</div><!-- /page -->




</body>
</html>