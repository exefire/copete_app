<!DOCTYPE html>
<html>
<head>
<title>Aloo Copete App</title>
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script type="text/javascript" charset="utf-8" src="jquery-1.8.2.min.js"></script>
<script type="text/javascript" charset="utf-8" src="jquery.mobile-1.2.0.min.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script type="text/javascript" charset="utf-8">
var url_master = 'http://www.aloocopete.cl/comandas/';	
var watchID = null;
// Wait for Cordova to load
//
document.addEventListener("deviceready", onDeviceReady, false);

// Cordova is ready
//
function onDeviceReady() {
		navigator.alert('Cordova is ready');
}

function getCurrentPosition() {
	$.mobile.changePage("#pagina02");
	navigator.geolocation.getCurrentPosition(onSuccess, onError);    
}

function watchPosition() {
	// Update every 3 seconds
	var options = { frequency: 3000 };
	watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
}
// onSuccess Geolocation
//
function onSuccess(position) {
	document.getElementById('lat').value = position.coords.latitude;
	document.getElementById('lon').value = position.coords.longitude;
	initialize(position.coords.latitude,position.coords.longitude);
}

// onError Callback receives a PositionError object
//
function onError(error) {
	var msg = 'Error Código: ' + error.code + '\n' + 'Mensaje: ' + error.message + '\n';
	navigator.notification.alert(
					msg,  // message
					alertDismissed,         // callback
					'Aloo Copete',            // title
					'OK'                  // buttonName
			);
}

function initialize(lat,lon) {
  var myLatlng = new google.maps.LatLng(lat,lon);
  var mapOptions = {
    zoom: 15,
    center: myLatlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  var marker = new google.maps.Marker({
      position: myLatlng,
      map: map,
      title: 'Tu Ubicación'
  });
}
// alert dialog dismissed
function alertDismissed() {
		// do something
}
function mostrar(){
	var lat = document.getElementById('lat').value;
	var lon = document.getElementById('lon').value;
	var location = ( '(' + lat + ',' + lon + ')');
	url = url_master + "poly_punto.php?buscar_sector="+location+'&app';
	
	$.ajax({
		url: url,
		beforeSend: function() { $.mobile.showPageLoadingMsg(); }, //Show spinner
		complete: function() { $.mobile.hidePageLoadingMsg(); }, //Hide spinner
		dataType: "jsonp",
		async: true,
		success: function (result) {
			var nombre = result['nombre'];
			var msg = 'Sector: ' + nombre;
			navigator.notification.alert(
					msg,  // message
					alertDismissed,         // callback
					'Aloo Copete',            // title
					'Listo!'                  // buttonName
			);
		},
		error: function (request,error) {
			var msg = 'Error conectando con el servidor!';
			navigator.notification.alert(
					msg,  // message
					alertDismissed,         // callback
					'Aloo Copete',            // title
					'OK'                  // buttonName
			);
		}
	});
}
</script>
<meta charset="UTF-8">
<style type="text/css">
html, body {
	height: 100%;
	margin: 0;
	padding: 0;
}
#map-canvas, #map_canvas {
	width: 100%;
	height: 200px;
}
[data-role=page] {
	height: 100% !important;
	position:relative !important;
}
[data-role=footer] {
	bottom:0;
	position:absolute !important;
	top: auto !important;
	width:100%;
}
</style>
<link href="jquery.mobile-1.2.0.min.css" rel="stylesheet" type="text/css">
</head>
<body>



<!-- Start of second page -->
<div data-role="page" id="bar">

	<div data-role="header">
    <h1>Aloo Copete</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>I'm the second in the source order so I'm hidden when the page loads. I'm just shown if a link that references my id is beeing clicked.</p>		
		<p><a href="#foo">Back to foo</a></p>	    
	</div><!-- /content -->

	<div data-role="footer">
		<!--<h4>Page Footer</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#bar" class="ui-btn-active">Two</a></li>
			<li><a href="#pagina01">One</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
	</div><!-- /footer -->
</div><!-- /page -->



<!-- Pasos 01 -->
<div data-role="page" id="pagina01">
  <div data-role="header">
    <h1>Aloo Copete</h1>
  </div>
  <!-- /header -->
  <div data-role="content">
    <h2>Relizar Pedido</h2>
    <p>Texto introductorio bla bla bla bla bla.</p>
    <input type="button" onClick="getCurrentPosition()" value="Comenzar" data-theme="b">
    <input type="button" onClick="watchPosition()" value="Actualizar" data-theme="b">

    <input type="text" name="lat" id="lat">
    <input type="text" name="lon" id="lon">
  </div>
  <!-- /content -->
  <div data-role="footer">
    <!--<h4>Delivery - Carrete Seguro</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#bar">Two</a></li>
			<li><a href="#pagina01" class="ui-btn-active">Pedido</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
  </div>
  <!-- /footer --> 
</div>
<!-- fin pasos 01 -->


<!-- Pasos 02 -->
<div data-role="page" id="pagina02">
  <div data-role="header">
    <h1>Aloo Copete</h1>
  </div>
  <!-- /header -->
  <div data-role="content">
      <h2>Tu Ubicación</h2>
      <div id="map-canvas" style="border:#666 solid 1px;"></div>
      <input type="button" onClick="window.location='#pagina03';" value="Siguiente" data-theme="b">
  </div>
  <!-- /content -->
  <div data-role="footer">
    <!--<h4>Delivery - Carrete Seguro</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#bar">Two</a></li>
			<li><a href="#pagina01" class="ui-btn-active">Pedido</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
  </div>
  <!-- /footer --> 
</div>
<!-- fin pasos 02 -->


<!-- Pasos 03 -->
<div data-role="page" id="pagina03">
  <div data-role="header">
    <h1>Aloo Copete</h1>
  </div>
  <!-- /header -->
  <div data-role="content">
    <h2>Tus Datos</h2>
    <div data-role="fieldcontain">
      <label for="cliente_nombre">Nombre:</label>
      <input type="text" name="cliente_nombre" id="cliente_nombre" value="" />
    </div>

    <div data-role="fieldcontain">
      <label for="cliente_telefono">Teléfono:</label>
      <input type="number" name="cliente_telefono" id="cliente_telefono" pattern="[0-9]*" value="" />
    </div>
		<input type="button" onClick="window.location='#pagina04';" value="Siguiente" data-theme="b">
  </div>
  <!-- /content -->
  <div data-role="footer">
    <!--<h4>Delivery - Carrete Seguro</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#bar">Two</a></li>
			<li><a href="#pagina01" class="ui-btn-active">Pedido</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
  </div>
  <!-- /footer --> 
</div>
<!-- fin pasos 03 -->




<!-- Pasos 04 -->
<div data-role="page" id="pagina04">
  <div data-role="header">
    <h1>Aloo Copete</h1>
  </div>
  <!-- /header -->
  <div data-role="content">
    <h2>Titulo</h2>
    
    
		<input type="button" onClick="window.location='#pagina04';" value="Siguiente" data-theme="b">
  </div>
  <!-- /content -->
  <div data-role="footer">
    <!--<h4>Delivery - Carrete Seguro</h4>-->
    <div data-role="navbar" data-iconpos="bottom">
     <ul>
			<li><a href="#bar">Two</a></li>
			<li><a href="#pagina01" class="ui-btn-active">Pedido</a></li>
			<li><a href="#">Three</a></li>
		</ul>
    </div>
  </div>
  <!-- /footer --> 
</div>
<!-- fin pasos 04 -->




</body>
</html>